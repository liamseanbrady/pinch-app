<% show_visibility ||= false %>

<div class="well">
  <span class="badge"><%= goal.category.name %></span>
  <% if show_visibility %>
    <span class="pull-right label label-<%= goal.visibility == 'public' ? 'success' : 'primary' %>"><%= goal.visibility %></span>
  <% end %>

  <h4><%= link_to goal.title, goal_path(goal) %></h4>
  <p><%= goal.description %></p>
  <small>Created by <%= link_to goal.creator.username, user_path(goal.creator) %></small>
  <br/>
  <br/>
  <p><strong><%= goal.learning_resources.size.zero? ? 'No' : goal.learning_resources.size %> learning resources available</strong></p>
  <p><strong>Pinchers: <%= goal.pincher_count %></strong></p>
  <p><strong>Contributors: <%= goal.contributor_count %></strong></p>

  <br/>

  <% if logged_in? %>
    <div class="btn-group">
      <button type="button" class="btn btn-default dropdown-toggle btn-block" data-toggle="dropdown" aria-expanded="false">
        Options <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu">
          <li>
            <%= link_to 'Edit', edit_goal_path(goal) if current_user == goal.creator %>
          </li>
          <% if !goal.pincher?(current_user) %>
            <li>
              <%= link_to 'Pinch', pinch_goal_path(goal), method: 'post' if current_user != goal.creator %>
            </li>
          <% else %>
            <li>
              <%= link_to 'Drop', drop_goal_path(goal), method: 'post' if current_user != goal.creator %>
            </li>
            <li>
              <%= link_to 'Request Contributor Status', goal_contribution_requests_path(goal), method: 'post' if current_user != goal.creator && !goal.contributor?(current_user) %>
            </li>
          <% end %>
            <li>
              <%= link_to 'Add Resource', new_goal_learning_resource_path(goal) if current_user == goal.creator || goal.contributor?(current_user) %>
            </li>
      </ul>
    </div>
  <% end %>
</div>

<br/>