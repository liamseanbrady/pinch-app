<div class="col-md-12">
  <%= render 'shared/header', title: 'Notifications' %>
</div>

<div class="notification-container">
  <div class="col-md-3">
    <ul class="nav nav-pills nav-stacked">
      <li class=<%= 'active' if params[:tab].nil? %>>
        <%= link_to notifications_path do %>
          Unread <span class="badge pull-right"><%= current_user.new_notification_count %></span>
        <% end %>
      </li>
      <li class=<%= 'active' if params[:tab] == 'read' %>>
        <%= link_to notifications_path(tab: 'read') do %>
          Awaiting Action <span class="pull-right badge"><%= current_user.read_request_count %></span>
        <% end %>
      </li>
    </ul>
  </div>

  <div class="col-md-9 notification-panel">
    <% if params[:tab].nil? %>

      <% if current_user.new_notification_count.zero? %>
          <div class="empty-message text-center text-muted">
            <span class="glyphicon glyphicon-inbox glyphicon-lg"></span>
            <br/>
            <h4>You have no unread notifications</h4>
          </div>
      <% else %>
        <% current_user.fresh_open_in_requests.each do |request| %>
          <p class="notification-text"><%= link_to request.sender.username, user_path(request.sender) %> has requested contribution status on <%= link_to request.goal.title, goal_path(request.goal) %><p>
          <%= link_to 'Accept', accept_goal_contribution_request_path(request.goal, request), method: 'patch', class: 'btn btn-success' %>
          <%= link_to 'Reject', reject_goal_contribution_request_path(request.goal, request), method: 'patch', class: 'btn btn-danger' %>
          <%= link_to 'Decide Later', mark_as_read_goal_contribution_request_path(request.goal, request), method: 'patch', class: 'btn btn-default' %>
        <% end %>
        <% current_user.fresh_closed_out_requests.each do |request| %>
          <p class="notification-text">Your request for contribution status on <%= link_to request.goal.title, goal_path(request.goal) %> was <%= request.accepted ? 'accepted' : 'rejected' %></p>
          <%= link_to 'Destroy', goal_contribution_request_path(request.goal, request), method: 'delete', class: 'btn btn-danger' %>
        <% end %>
      <% end %>

      <% if current_user.notifications_of_goal_being_pinched.any? %>
        <% current_user.notifications_of_goal_being_pinched.each do |pinched_notif| %>
          <p class="notification-text"><%= link_to pinched_notif.pincher.username, user_path(pinched_notif.pincher) %> pinched <%= link_to pinched_notif.goal.title, goal_path(pinched_notif.goal) %> on <%= display_datetime(pinched_notif.created_at) %><p>
          <%= link_to 'Destroy', pinch_notification_path(pinched_notif), method: 'delete', class: 'btn btn-danger' %>
        <% end %>
      <% end %>

    <% end %>

    <!-- TODO: Change these below to read_open_in_request and read_pinched_notifications -->

    <% if params[:tab] == 'read' %>

      <% if current_user.read_request_count.zero? %>
          <div class="empty-message text-center text-muted">
            <span class="glyphicon glyphicon-ok glyphicon-lg glyphicon-success"></span>
            <br/>
            <h4>Relax - you've taken care of everything.</h4>
          </div>
      <% end %>

      <% current_user.open_in_requests.each do |request| %>
        <p class="notification-text"><%= link_to request.sender.username, user_path(request.sender) %> has requested contribution status on <%= link_to request.goal.title, goal_path(request.goal) %><p>
        <%= link_to 'Accept', accept_goal_contribution_request_path(request.goal, request), method: 'patch', class: 'btn btn-success' %>
        <%= link_to 'Reject', reject_goal_contribution_request_path(request.goal, request), method: 'patch', class: 'btn btn-danger' %>
      <% end %>
    <% end %>


  </div>
</div>


